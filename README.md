# LIKES. High-load applications.


Мы рассматриваем архитектуру счётчиков на высоконагруженных интернет приложениях. 

Счётчики - это лайки, просмотры, посещения, репосты, количество новых сообщений, оповещений и т.д.

## Задача

Необходимо считывать количество лайков с данной страницы (поста) и предоставлять информацию пользователю в «реальном времени», т.е. время отклика сервера должно быть минимально.

## Архитектура

Различают монолитную архитектуру и архитектуру микросервисов. В первом случае выше надежность, согласованность кода, данных, во втором случае выше гибкость, доступность. Многие высоконагруженные приложения – социальные сети, используют микросервисную архитектуру. 

Мы выделили систему обработки счётчиков в отдельный микросервис, который снимает часть нагрузки с других сервисов, занимаясь хранением внутренних данных.

Данные счётчиков во многих социальных сетях актуальны постоянно. Поэтому прямое обращение к базе данных за каждым небольшим объёмом информации может стать узким горлом в работе системы. Memcache - эффиктивная технология для работы с key-value базами данных. Эта система позволит обращаться к актуальным данным значительно быстрее.

## Ограничения
### Отображение лайков
При достижении N лайков переходим к обобщенному отображению (например, 1.5К) на клиенте, но продолжаем увеличивать счетчик.
### Хранение счетчика лайков для поста
На начальном этапе проектирования микросервиса предполагаем, что пользователей будет немного и типа INT [диапазон без знака от 0 до 4294967295, 32-бит для MySQL, MongoDB] для поля счетчика будет достаточно.
Однако при приближении значения счетчика к предельной величине (с учетом, что таких постов будет немного) можно использовать следующий алгоритм.

Идея состоит в использовании нескольких полей для счетчика и суммировании значений из них.

Для поля счетчика можно хранить список ссылок на связанные с ним поля (пустой, если поле одно) и индекс в списке для данного поля в базе данных. При приближении к пределу будем использовать новое поле и указывать ссылку на него. Список можно хранить только с первым значением, для других указывать ссылку на первое поле и индекс в списке.
Также необходимо реализовать механизм отслеживания «приближений к пределу».
### Используемая память
Необходимо определить, сколько занимает БД с счетчиком лайков.
На каждый лайк в БД хранится post_id, поле-счётчик, список пользователей. Общий размер списка пользователей - количество пар (post_id, user_id). Каждая занимает 1 int (4 байт), так как хранится только user_id в списке. Размером счётчика и идентификатора поста можно принебречь.
Таким образом можем рассчитать вместимость memcached или жесткого диска - т.е. количество записей, которое можем хранить в оперативной памяти или на одном жестком диске.
Например, для сервера с 48 Гб оперативной памяти получим 13 миллиардов записей.


---

* [Алёна Смирнова](https://github.com/alsmirnova)
* [Георгий Кубрин](https://github.com/Georgiy0)
* [Владислав Анисимов](https://github.com/ShittyWizard)
* [Никита Супротивный](https://github.com/NSuprotivniy)

